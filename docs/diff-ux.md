# Claude Code 스타일 Diff UX (터미널 모드)

## 개념
AI가 제안한 코드 변경을 **사용자가 안전하게 이해하고, 선택하고, 통제**하게 만드는 UX 패턴이다. 핵심 원칙은 **AI는 제안만 하고, 적용 여부는 사람이 결정**한다는 점이다.

## 흐름
1. 사용자가 터미널에서 리팩토링이나 수정 요청을 보낸다.
2. 백엔드가 변경 이유와 함께 **diff 제안**을 반환한다. (이 시점에 파일은 수정되지 않는다.)
3. VS Code의 Diff 프리뷰에서 줄 단위로 변경을 시각화한다.
4. 사용자가 **Apply / Reject / Regenerate** 중 하나를 선택한다. 적용 전까지 워크스페이스는 그대로 유지된다.
5. 적용 후에도 VS Code Undo 또는 Git diff로 언제든 되돌릴 수 있다.

## 구성 요소
- **Diff 데이터**: unified diff 또는 before/after 블록으로 변경 범위를 명확히 표현.
- **설명 블록**: 변경 이유, 개선점, 잠재적 부작용을 함께 제시해 신뢰도를 높임.
- **승인 UX**: 자동 적용 금지, 명시적 승인(Apply), 거절(Reject), 재생성(Regenerate) 버튼을 제공.
- **안전망**: VS Code Diff Editor, Git 연동, Undo로 롤백 가능성을 보장.

## 왜 중요한가
- 프로덕션 코드와 복잡한 도메인을 다룰 때 **신뢰와 통제**를 제공한다.
- "AI가 내 코드를 몰래 바꾼다"는 불신을 해소하고, 리뷰 감각을 유지한 채 도입할 수 있다.
- VS Code가 기본 제공하는 Diff Editor와 Git 통합을 활용해 Claude Code 이상으로 투명한 경험을 만들 수 있다.

## 터미널 모드 고려사항
- 터미널 요청에 대한 기본 응답 포맷을 **diff + 설명**으로 강제한다 (JSON 계약 필요).
- 단일/다중 파일 diff 모두를 Diff Editor에서 열 수 있도록 파일 경로 포함.
- Apply 직전까지는 워크스페이스 파일을 수정하지 않고, 선택한 항목만 패치한다.
- 적용된 변경은 터미널에도 로그를 남겨 추적 가능하게 한다.

## 다음 단계
- VS Code에서 Diff Preview를 띄우는 헬퍼를 추가하고, Apply/Reject 명령과 연결한다.
- 백엔드 계약에 `changes: [{path, diff, rationale}]` 형태를 정의해 **diff + 설명**을 강제한다.
- 멀티 파일 diff를 순회하며 선택 적용할 수 있는 UI(QuickPick/웹뷰) 설계.
- Git 상태를 활용해 적용 전/후를 재확인하고, Undo 시나리오를 문서화한다.
