# 아키텍처 메모

## 구성 요소
- **명령 레이어**: `openTerminal`, `runInstruction` 명령을 노출하고 VS Code UI(입력창, 터미널)와 연동합니다.
- **API 클라이언트**: 작업 공간 컨텍스트와 선택한 모델을 포함한 지시문 페이로드를 외부 엔드포인트로 전송합니다.
- **터미널 뷰**: 지시문과 응답을 보여주는 전용 `Zeta AI Terminal` 인스턴스를 제공합니다.
- **설정**: 엔드포인트, API 키, 모델 이름을 다루는 사용자 설정을 사용합니다.
- **Diff UX**: AI가 제안한 변경을 Diff 프리뷰로 띄우고 사용자가 Apply/Reject/Regenerate를 선택하도록 합니다.

## 데이터 흐름
1. 사용자가 `runInstruction`을 실행하고 지시문을 입력합니다.
2. 확장이 현재 워크스페이스 경로와 모델을 포함해 지시문을 구성한 뒤 `POST /instructions`로 보냅니다.
3. 응답 본문은 전용 터미널에 출력되고, diff가 포함된 경우 Diff Editor 프리뷰로 열어 사용자의 확인을 받습니다.
4. 사용자가 Apply를 선택하면 대상 파일에만 패치를 적용하고, Reject/Regenerate를 통해 안전하게 건너뛸 수 있습니다.

## 보안 고려사항
- 가능하면 VS Code 인증 세션에 저장된 토큰을 우선 사용하고, 없을 경우 `zeta.apiKey`로 대체합니다.
- 비밀값을 확장 저장소에 영구 저장하지 말고 호스트의 보안 기능에 의존합니다.
- 오용을 줄이기 위해 레이트 리밋 및 오류 메시지 전략을 마련합니다.

## 확장성 포인트
- `sendInstruction`을 스트리밍 처리기로 교체할 수 있도록 설계합니다.
- 향후 빠른 액션을 위해 파일 참조 등 구조화된 메타데이터를 첨부하는 경로를 고려합니다.
- 진단·원격 측정을 위한 로깅 레이어를 추가하되, 사용자 설정으로 제어합니다.
